<script type="text/javascript">
    let FB_appID = "956770072780601";
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    window.fbAsyncInit = function () {
        FB.init({
            appId: FB_appID,
            cookie: true,
            xfbml: true,
            version: 'v19.0'  // 確保使用最新版本
        });
        FB.AppEvents.logPageView();
    };

    function FBLogin() {
        FB.getLoginStatus(function (res) {
            if (res.status === "connected") {
                alert("已經登入，請先登出再試一次。");
            } else {
                FB.login(function (response) {
                    if (response.status === 'connected') {
                        GetProfile();
                    } else {
                        alert("Facebook帳號無法登入");
                    }
                }, { scope: 'email' });
            }
        });
    }

    function GetProfile() {
        document.getElementById('content').innerHTML = "";
        FB.api("/me", "GET", { fields: 'last_name,first_name,name,email' }, function (user) {
            if (user.error) {
                console.log(user.error);
            } else {
                document.getElementById('content').innerHTML = JSON.stringify(user);
            }
        });
    }

    function Del_FB_App() {
        FB.getLoginStatus(function (response) {
            if (response.status === 'connected') {
                FB.api("/me/permissions", "DELETE", function (response) {
                    if (response.success) {
                        alert("授權已成功移除");
                        FB.getLoginStatus(function (res) { }, true);  // 強制刷新狀態
                    } else {
                        console.log("移除授權失敗", response);
                    }
                });
            } else { 
                alert("尚未登入或已登出");
            }
        });
    }
</script>
